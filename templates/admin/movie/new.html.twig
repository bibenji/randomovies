{% extends 'layout.html.twig' %}

{% block title %}Admin - Movie Creation{% endblock %}

{% block body %}
	<div class="jumbotron">

		<h1 class="text-center">Movie Creation</h1>
		<hr/>

		{{ include('admin/movie/movie_form/movie_form.html.twig', {'form': form}) }}

	</div>
{% endblock %}

{% block javascripts %}
	<script>

//        var $collectionHolder;

        $(function(){

            // création de nouveaux tags
            $('#new-tag-submit').on('click', function(event) {
                event.preventDefault();

                var newTagValue = $('#new-tag').val();
                if (newTagValue !== '' && newTagValue.length >= 3) {

                    var createTagUrl = Routing.generate('tag_create');
                    var data = {name: newTagValue};
                    var success = function() {
                        console.log('success');
                        $('#new-tag').val('');
                    };

                    $.ajax({
                        type: "POST",
                        url: createTagUrl,
                        data: data,
                        success: success,
                        dataType: 'json'
                    });

				}
			})

            // gestion des collections

            $collectionHolder = $('ul.roles');
            $collectionHolder.data('index', $collectionHolder.find(':input').length / 3); // divisé par 3 car compte le nombre de champs

	        function addOneRole($collectionHolder) {
	            console.log("addOneRole function...");

            	var prototype = $collectionHolder.data('prototype');

	            var index = $collectionHolder.data('index');

	            var newForm = prototype;
				// You need this only if you didn't set 'label' => false in your tags field in TaskType
				// Replace '__name__label__' in the prototype's HTML to
				// instead be a number based on how many items we have
				 newForm = newForm.replace(/__name__label__/g, index);

				// Replace '__name__' in the prototype's HTML to
				// instead be a number based on how many items we have
				newForm = newForm.replace(/__name__/g, index);

				// increase the index with one for the next item
				$collectionHolder.data('index', index + 1);

				// Display the form in the page in an li, before the "Add a tag" link li
				var $newFormLi = $('<li></li>').append(newForm);
                $collectionHolder.append($newFormLi);

        	}

            $addRoleButton = $('#add_role_button');

            $addRoleButton.on('click', function(e) {
                e.preventDefault();

                addOneRole($collectionHolder);
            });

        });

	</script>
{% endblock %}
